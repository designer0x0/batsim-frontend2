<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜救系統監控</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <h1>
        <span class="connection-status disconnected" id="connectionStatus"></span>
        智慧化 AI 船舶群集搜救系統監控
    </h1>
    
    <div class="phase" id="phase">Gathering</div>
    
    <div>
        <button onclick="resetSimulation()">重置模擬</button>
        <button onclick="fetchState()">手動更新</button>
        <button onclick="resetMapView()" style="background: #FF9800;">重設地圖視角</button>
    </div>
    
    <div class="container">
        
        <div class="panel">
            <h2>系統狀態</h2>
            <div class="status">
                <span>風向 (θ):</span>
                <span id="theta">--</span>
            </div>
            <div class="status">
                <span>船隻總數:</span>
                <span id="shipCount">--</span>
            </div>
            <div class="status">
                <span>執行中船隻:</span>
                <span id="activeShips">--</span>
            </div>
            <div class="status">
                <span>待救人數:</span>
                <span id="personCount" style="color: #F44336; font-weight: bold;">--</span>
            </div>
            <div class="status">
                <span>模擬時間:</span>
                <span id="timestamp">--</span>
            </div>
        </div>
        
        <div class="panel">
            <h2>船隻狀態</h2>
            <div style="margin-bottom: 10px;">
                <button id="startBtn" onclick="sendShipCommand('start', 'ALL')">啟動</button> 
                <button id="pauseBtn" onclick="sendShipCommand('stop', 'ALL')">停止</button>
            </div>
            <div id="shipsList"></div>
        </div>
        
        <div class="panel" style="grid-column: 1 / -1;">
            <h2>即時地圖視圖</h2>
            <div id="canvas-container">
                <div class="zoom-controls">
                    <button onclick="zoomMap(1.2)">+</button>
                    <button onclick="zoomMap(1/1.2)">-</button>
                </div>

                <div id="wind-indicator">
                    <div class="wind-label wind-n">N</div>
                    <div class="wind-label wind-e">E</div>
                    <div class="wind-label wind-s">S</div>
                    <div class="wind-label wind-w">W</div>
                    <div id="wind-needle"></div>
                    <div id="wind-center"></div>
                    <div style="margin-top: 50px; position: absolute; font-size: 10px;" id="wind-theta">--</div>
                </div>

                <div id="canvas">
                    <div class="legend">
                        <div style="font-weight: bold; margin-bottom: 8px;">圖例</div>
                        <div class="legend-item">
                            <div class="legend-icon legend-ship"></div>
                            <span>執行中船隻</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon legend-ship-waiting"></div>
                            <span>等待中船隻</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon legend-person"></div>
                            <span>落水者</span>
                        </div>
                    </div>
                </div>
                <div id="mouse-coordinates" style="position: absolute; bottom: 10px; left: 10px; background: rgba(0, 0, 0, 0.7); color: white; padding: 5px; border-radius: 5px; font-size: 12px; z-index: 10;">
                    X: --, Z: --
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2>已搜救人員 (<span id="personCountInList">0</span>人)</h2>
            <div id="personsList"></div>
        </div>

        <div class="control-panel">
            <h2>手動設定航點 (Waypoint)</h2>
            <div class="control-group">
                <label for="shipSelectWaypoint" style="display: block; margin-bottom: 5px;">選擇船隻:</label>
                <select id="shipSelectWaypoint">
                </select>
            </div>
            <div class="control-group">
                <label for="waypointsInput" style="display: block; margin-bottom: 5px;">
                    航點座標 (JSON 陣列):
                </label>
                <textarea id="waypointsInput" rows="4" style="width: 100%; padding: 5px; box-sizing: border-box;">[]</textarea>
            </div>
            
            <div class="waypoint-buttons">
                <button onclick="toggleWaypointRecording()" id="recordWaypointBtn">
                    錄製航點
                </button>
                <button onclick="addWaypoint()" class="send-btn">
                    發送航點
                </button>
            </div>
            </div>
    </div>

    <script src="js/app.js"></script> 
    <script src="js/mapRender.js"></script> 
</body>
</html>